<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Send Traffic Incident Report</title>
    <h1>Traffic Report</h1>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</head>
<body>

<form action="#" th:action="@{/createReport}" th:object="${trafficIncident}" method="GET">

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text" id="location">Search Location</span>
        </div>
        <input type="text" class="form-control" aria-label="default" aria-describedby="default" id="locationSearch">
    </div>

    <div id="map" style="width:600px; height: 400px;"></div>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text" id="description">Description</span>
        </div>
        <input type="text" class="form-control" aria-label="default" aria-describedby="default" th:field="*{description}">
    </div>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <div class="input-group-text">
                <input type="checkbox" aria-label="" id="current-location-check" onclick="currentLocationOnCheck()">
            </div>
        </div>
        <input type="text" class="form-control" aria-label="" value="Use Current Location" readonly>
    </div>

    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <label class="input-group-text" for="inputGroupSelect01">Severity Level</label>
        </div>
        <select class="custom-select" id="inputGroupSelect01" th:field="*{severity}">
            <option value="fatal">Fatal</option>
            <option value="serious">Serious</option>
            <option value="light">Light</option>
        </select>
    </div>

    <input id="longitude" style="display: none; visibility: hidden" name="description" th:field="*{longitude}"/>
    <input id="latitude" style="display: none; visibility: hidden " name="description" th:field="*{latitude}"/>

    <button type="submit" class="btn btn-secondary" value="0">Submit Report</button>


</form>


<script th:inline="javascript">
    function currentLocationOnCheck() {
        var checkBox = document.getElementById("current-location-check");

        if (checkBox.checked) {

            navigator.geolocation.getCurrentPosition((position) => {
                document.getElementById("longitude").value = position.coords.longitude
                document.getElementById("latitude").value = position.coords.latitude
            })
        }
    }

</script>

<script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap" async defer></script>

<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 39.103119, lng: -84.512016},
            zoom: 13
        });

        var input = document.getElementById('locationSearch');
        var autocomplete = new google.maps.places.Autocomplete(input);

        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
            map: map
        });
        function placeMarker(location) {
            if (marker) {
                marker.setPosition(location);
            } else {
                marker = new google.maps.Marker({
                    position: location,
                    map: map,
                    icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
                });
            }
            document.getElementById('latitude').value = place.geometry.location.lat();
            document.getElementById('longitude').value= place.geometry.location.lng();
        }
        google.maps.event.addListener(map, 'click', function(event) {
            placeMarker(event.latLng);
        });

        autocomplete.addListener('place_changed', function() {
            infowindow.close();
            var place = autocomplete.getPlace();

            map.setCenter(place.geometry.location);
            map.setZoom(15);

            marker.setPosition(place.geometry.location);
            marker.setVisible(true);

            document.getElementById('latitude').value = place.geometry.location.lat();
            document.getElementById('longitude').value= place.geometry.location.lng();
        });
    }
</script>

</body>
</html>